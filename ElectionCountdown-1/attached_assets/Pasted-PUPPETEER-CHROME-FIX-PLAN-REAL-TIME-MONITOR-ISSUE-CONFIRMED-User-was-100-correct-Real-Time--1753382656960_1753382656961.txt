PUPPETEER CHROME FIX PLAN - REAL-TIME MONITOR

ISSUE CONFIRMED

✅ User was 100% correct - Real-Time Monitor fails with Puppeteer Chrome error:

Plain Text


Failed to Start Monitoring
500: {"error":"Failed to start monitoring","details":"Could not find Chrome (ver. 137.0.7151.55). This can occur if either\n 1. you did not perform an installation before running the script (e.g. `npx puppeteer browsers install chrome`) or 2. your cache path is incorrectly configured (which is: /home/runner/.cache/puppeteer).\nFor (2), check out our guide on configuring puppeteer at https://pptr.dev/guides/configuration."}


ROOT CAUSE ANALYSIS

1.
Missing Chrome Installation: Puppeteer requires Chrome browser to be installed

2.
Replit Environment: Replit doesn't have Chrome pre-installed

3.
Cache Path Issues: Puppeteer cache directory not properly configured

4.
System Dependencies: Missing required Linux dependencies for Chrome

COMPREHENSIVE FIX STRATEGY

Phase 1: Install Chrome Browser

Bash


# Install Chrome browser for Puppeteer
npx puppeteer browsers install chrome

# Alternative: Install specific Chrome version
npx @puppeteer/browsers install chrome@stable


Phase 2: Install System Dependencies

Bash


# Install required Linux dependencies for Chrome
sudo apt-get update
sudo apt-get install -y \
  ca-certificates \
  fonts-liberation \
  libappindicator3-1 \
  libasound2 \
  libatk-bridge2.0-0 \
  libatk1.0-0 \
  libc6 \
  libcairo2 \
  libcups2 \
  libdbus-1-3 \
  libexpat1 \
  libfontconfig1 \
  libgbm1 \
  libgcc1 \
  libglib2.0-0 \
  libgtk-3-0 \
  libnspr4 \
  libnss3 \
  libpango-1.0-0 \
  libpangocairo-1.0-0 \
  libstdc++6 \
  libx11-6 \
  libx11-xcb1 \
  libxcb1 \
  libxcomposite1 \
  libxcursor1 \
  libxdamage1 \
  libxext6 \
  libxfixes3 \
  libxi6 \
  libxrandr2 \
  libxrender1 \
  libxss1 \
  libxtst6 \
  lsb-release \
  wget \
  xdg-utils


Phase 3: Configure Puppeteer

JavaScript


// puppeteer.config.js
const { join } = require('path');

module.exports = {
  cacheDirectory: join(__dirname, '.cache', 'puppeteer'),
  experiments: {
    macArmChromiumEnabled: true,
  },
};


Phase 4: Update Launch Configuration

JavaScript


// Fixed Puppeteer launch configuration
const browser = await puppeteer.launch({
  headless: 'new',
  args: [
    '--no-sandbox',
    '--disable-setuid-sandbox',
    '--disable-dev-shm-usage',
    '--disable-accelerated-2d-canvas',
    '--no-first-run',
    '--no-zygote',
    '--single-process',
    '--disable-gpu'
  ],
  executablePath: process.env.PUPPETEER_EXECUTABLE_PATH || undefined
});


Phase 5: Environment Variables

Bash


# Set environment variables for Puppeteer
export PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=false
export PUPPETEER_CACHE_DIR=/home/runner/.cache/puppeteer
export PUPPETEER_EXECUTABLE_PATH=/home/runner/.cache/puppeteer/chrome/linux-*/chrome-linux*/chrome


IMPLEMENTATION STEPS

Step 1: Access Replit Console

1.
Open the Replit project

2.
Open the Shell/Console tab

3.
Run the installation commands

Step 2: Install Chrome

Bash


cd /home/runner/ElectionsCountDown
npx puppeteer browsers install chrome


Step 3: Install Dependencies

Bash


# Install system dependencies
sudo apt-get update && sudo apt-get install -y \
  libgtk-3-dev libnotify-dev libgconf-2-4 \
  libnss3-dev libxss1 libxtst6 libxrandr2 \
  libasound2-dev libpangocairo-1.0-0 \
  libatk1.0-dev libcairo-gobject2 \
  libgtk-3-dev libgdk-pixbuf2.0-dev


Step 4: Update Package.json

JSON


{
  "scripts": {
    "postinstall": "npx puppeteer browsers install chrome",
    "start": "node server.js"
  },
  "dependencies": {
    "puppeteer": "^21.11.0"
  }
}


Step 5: Fix Server Code

JavaScript


// server/monitoring.js - Fixed implementation
const puppeteer = require('puppeteer');

async function startMonitoring() {
  try {
    const browser = await puppeteer.launch({
      headless: 'new',
      args: [
        '--no-sandbox',
        '--disable-setuid-sandbox',
        '--disable-dev-shm-usage',
        '--disable-accelerated-2d-canvas',
        '--no-first-run',
        '--no-zygote',
        '--single-process',
        '--disable-gpu',
        '--disable-web-security',
        '--disable-features=VizDisplayCompositor'
      ]
    });
    
    const page = await browser.newPage();
    await page.goto('https://example.com');
    
    console.log('Monitoring started successfully');
    return { success: true, message: 'Monitoring started' };
    
  } catch (error) {
    console.error('Monitoring failed:', error);
    return { success: false, error: error.message };
  }
}

module.exports = { startMonitoring };


TESTING VERIFICATION

Test 1: Chrome Installation

Bash


# Verify Chrome is installed
ls -la ~/.cache/puppeteer/chrome/


Test 2: Puppeteer Test Script

JavaScript


// test-puppeteer.js
const puppeteer = require('puppeteer');

(async () => {
  try {
    const browser = await puppeteer.launch({ headless: 'new' });
    const page = await browser.newPage();
    await page.goto('https://example.com');
    console.log('✅ Puppeteer working correctly!');
    await browser.close();
  } catch (error) {
    console.error('❌ Puppeteer failed:', error.message);
  }
})();


Test 3: Real-Time Monitor

1.
Start the application

2.
Navigate to Real-Time Monitor

3.
Click "Start Monitoring"

4.
Verify no error appears

EXPECTED RESULTS

•
✅ Chrome browser installed in Puppeteer cache

•
✅ All system dependencies available

•
✅ Real-Time Monitor starts without errors

•
✅ Monitoring functionality operational

•
✅ No more "Could not find Chrome" errors

ROLLBACK PLAN

If issues persist:

1.
Clear Puppeteer cache: rm -rf ~/.cache/puppeteer

2.
Reinstall Puppeteer: npm uninstall puppeteer && npm install puppeteer

3.
Use alternative: puppeteer-core with external Chrome

4.
Consider browserless.io service for cloud-based browser

MAINTENANCE

•
Monitor Chrome version compatibility

•
Update Puppeteer regularly

•
Check system dependencies after Replit updates

•
Test monitoring functionality weekly

