CONGRESS API FIX PLAN - FIND MISSING MEMBERS

ISSUE CONFIRMED

✅ User was 100% correct - "Find Missing Members" functionality fails with:

Plain Text


Error: Perplexity API error: 400


ROOT CAUSE ANALYSIS

1.
Perplexity API Failure: The current implementation relies on Perplexity API which is returning 400 errors

2.
No Backup API: No fallback mechanism when primary API fails

3.
Missing Official APIs: Not using official Congress APIs that are freely available

4.
Data Gaps: 7 missing members (528/535 total), 8 missing House members, 1 extra Senate member

AVAILABLE CONGRESS APIS

1. Congress.gov API (Official - Library of Congress)

•
Endpoint: https://api.congress.gov/v3/member

•
Documentation: https://api.congress.gov/

•
Authentication: API key from api.data.gov (free)

•
Coverage: All current and historical members

•
Reliability: Official government source

2. ProPublica Congress API

•
Endpoint: https://api.propublica.org/congress/v1/{congress}/{chamber}/members.json

•
Documentation: https://projects.propublica.org/api-docs/congress-api/members/

•
Authentication: API key (free)

•
Coverage: Current Congress members

•
Note: Represent API discontinued (July 2024)

3. United States Congress Legislators (GitHub)

•
Source: https://github.com/unitedstates/congress-legislators

•
Format: JSON/YAML/CSV

•
Authentication: None (public repository)

•
Coverage: All members 1789-Present

•
Reliability: Community-maintained, regularly updated

4. Sunlight Foundation Congress API

•
Endpoint: https://congress.api.sunlightfoundation.com/legislators

•
Documentation: https://sunlightlabs.github.io/congress/

•
Authentication: API key (free)

•
Coverage: Current and historical members

COMPREHENSIVE FIX STRATEGY

Phase 1: Implement Multiple API Sources

JavaScript


const congressAPIs = {
  primary: 'congress.gov',
  fallback1: 'propublica',
  fallback2: 'github-legislators',
  fallback3: 'sunlight'
};


Phase 2: Congress.gov API Implementation

JavaScript


// Congress.gov API - Official source
async function getCongressMembers() {
  const apiKey = process.env.CONGRESS_GOV_API_KEY;
  const url = `https://api.congress.gov/v3/member?api_key=${apiKey}&limit=250&currentMember=true`;
  
  try {
    const response = await fetch(url);
    const data = await response.json();
    return data.members;
  } catch (error) {
    console.error('Congress.gov API failed:', error);
    throw error;
  }
}


Phase 3: ProPublica API Implementation

JavaScript


// ProPublica Congress API - Backup source
async function getProPublicaMembers() {
  const apiKey = process.env.PROPUBLICA_API_KEY;
  const congress = 118; // Current Congress
  
  const [houseResponse, senateResponse] = await Promise.all([
    fetch(`https://api.propublica.org/congress/v1/${congress}/house/members.json`, {
      headers: { 'X-API-Key': apiKey }
    }),
    fetch(`https://api.propublica.org/congress/v1/${congress}/senate/members.json`, {
      headers: { 'X-API-Key': apiKey }
    })
  ]);
  
  const houseData = await houseResponse.json();
  const senateData = await senateResponse.json();
  
  return [
    ...houseData.results[0].members,
    ...senateData.results[0].members
  ];
}


Phase 4: GitHub Legislators Implementation

JavaScript


// GitHub United States Congress Legislators - No API key needed
async function getGitHubLegislators() {
  const url = 'https://raw.githubusercontent.com/unitedstates/congress-legislators/main/legislators-current.json';
  
  try {
    const response = await fetch(url);
    const legislators = await response.json();
    return legislators;
  } catch (error) {
    console.error('GitHub legislators API failed:', error);
    throw error;
  }
}


Phase 5: Cascading API Strategy

JavaScript


async function findMissingMembers() {
  const strategies = [
    { name: 'Congress.gov', fn: getCongressMembers },
    { name: 'ProPublica', fn: getProPublicaMembers },
    { name: 'GitHub', fn: getGitHubLegislators },
    { name: 'Sunlight', fn: getSunlightMembers }
  ];
  
  for (const strategy of strategies) {
    try {
      console.log(`Trying ${strategy.name} API...`);
      const members = await strategy.fn();
      const analysis = analyzeMemberData(members);
      return {
        success: true,
        source: strategy.name,
        analysis: analysis,
        members: members
      };
    } catch (error) {
      console.error(`${strategy.name} failed:`, error);
      continue;
    }
  }
  
  throw new Error('All Congress APIs failed');
}


MEMBER DATA ANALYSIS

Expected Numbers (118th Congress)

•
Total Members: 535

•
House: 435 representatives

•
Senate: 100 senators (2 per state)

•
Territories: Non-voting delegates

Data Validation Logic

JavaScript


function analyzeMemberData(members) {
  const analysis = {
    total: members.length,
    house: members.filter(m => m.chamber === 'House').length,
    senate: members.filter(m => m.chamber === 'Senate').length,
    byState: {},
    issues: []
  };
  
  // Check for missing House members
  if (analysis.house < 435) {
    analysis.issues.push(`Missing ${435 - analysis.house} House members`);
  }
  
  // Check for missing Senate members
  if (analysis.senate < 100) {
    analysis.issues.push(`Missing ${100 - analysis.senate} Senate members`);
  }
  
  // Check for extra Senate members (like NJ: 3 senators issue)
  const stateSenateCounts = {};
  members.filter(m => m.chamber === 'Senate').forEach(senator => {
    const state = senator.state;
    stateSenateCounts[state] = (stateSenateCounts[state] || 0) + 1;
  });
  
  Object.entries(stateSenateCounts).forEach(([state, count]) => {
    if (count !== 2) {
      analysis.issues.push(`${state}: ${count} senators (expected 2)`);
    }
  });
  
  return analysis;
}


IMPLEMENTATION FILES

1. congress-api-service.js

JavaScript


class CongressAPIService {
  constructor() {
    this.apis = [
      new CongressGovAPI(),
      new ProPublicaAPI(),
      new GitHubLegislatorsAPI(),
      new SunlightAPI()
    ];
  }
  
  async findMissingMembers() {
    for (const api of this.apis) {
      try {
        const result = await api.getMembers();
        return this.analyzeMembers(result);
      } catch (error) {
        console.error(`${api.name} failed:`, error);
        continue;
      }
    }
    throw new Error('All Congress APIs failed');
  }
  
  analyzeMembers(members) {
    // Implementation of member analysis
    return {
      total: members.length,
      missing: this.findMissingMembers(members),
      issues: this.detectIssues(members)
    };
  }
}


2. Fixed API Route

JavaScript


// Replace the failing Perplexity API call
app.post('/api/congress/find-missing', async (req, res) => {
  try {
    const congressService = new CongressAPIService();
    const analysis = await congressService.findMissingMembers();
    
    res.json({
      success: true,
      analysis: analysis,
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      error: 'Failed to analyze congressional data',
      details: error.message
    });
  }
});


ENVIRONMENT VARIABLES NEEDED

Bash


# Congress.gov API (free from api.data.gov)
CONGRESS_GOV_API_KEY=your_api_key_here

# ProPublica Congress API (free)
PROPUBLICA_API_KEY=your_api_key_here

# Sunlight Foundation API (free)
SUNLIGHT_API_KEY=your_api_key_here


TESTING VERIFICATION

Test 1: API Connectivity

Bash


# Test Congress.gov API
curl "https://api.congress.gov/v3/member?api_key=YOUR_KEY&limit=10"

# Test ProPublica API
curl -H "X-API-Key: YOUR_KEY" "https://api.propublica.org/congress/v1/118/house/members.json"

# Test GitHub API (no key needed)
curl "https://raw.githubusercontent.com/unitedstates/congress-legislators/main/legislators-current.json"


Test 2: Member Count Validation

JavaScript


// Expected results
const expected = {
  total: 535,
  house: 435,
  senate: 100
};

// Test against each API
const results = await testAllAPIs();
console.log('API Results:', results);


Test 3: Missing Member Detection

JavaScript


// Should identify specific missing members
const missing = await findSpecificMissingMembers();
console.log('Missing members:', missing);


DEPLOYMENT STEPS

1.
Get API Keys

•
Register at api.data.gov for Congress.gov API

•
Register at ProPublica for Congress API

•
Register at Sunlight Foundation for API



2.
Update Environment Variables

•
Add API keys to Replit secrets

•
Configure fallback order



3.
Deploy New Service

•
Replace Perplexity API calls

•
Implement cascading API strategy

•
Add comprehensive error handling



4.
Test Functionality

•
Click "Find Missing Members"

•
Verify no "Perplexity API error: 400"

•
Confirm accurate member analysis



EXPECTED RESULTS

•
✅ No more Perplexity API errors

•
✅ Accurate congressional member counts

•
✅ Identification of missing members

•
✅ Detection of data issues (like NJ: 3 senators)

•
✅ Reliable backup APIs

•
✅ Real-time congressional data

MAINTENANCE

•
Monitor API rate limits

•
Update Congress numbers for new sessions

•
Refresh API keys as needed

•
Add new APIs as they become available

